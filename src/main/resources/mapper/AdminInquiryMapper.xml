<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper  namespace="com.road_friends.rentalcar.mapper.AdminInquiryMapper">

    <!-- 관리자 질문 전체 조회 -->
    <select id="findAllInquiry" resultType="com.road_friends.rentalcar.dto.AdminInquiryDto">
        SELECT inquiries_num, user_num, admin_num, inquiries_q, inquiries_a, inquiries_q_created_at, inquiries_a_created_at
        FROM inquiries
        ORDER BY inquiries_num
        LIMIT #{size}
        OFFSET #{offset};
    </select>

    <!-- 문의 게시글 총 개수-->
    <select id="countTotal" resultType="Integer">
        SELECT count(*) FROM inquiries;
    </select>

    <!-- 관리자 질문 상세 조회 -->
    <select id="findInquiryById" resultType="com.road_friends.rentalcar.dto.AdminInquiryDto">
        SELECT inquiries_num, user_num, admin_num, inquiries_q, inquiries_a, inquiries_q_created_at, inquiries_a_created_at
        FROM inquiries
        WHERE inquiries_num = #{inquiryId};
    </select>

    <!-- 관리자 질문 답변 작성 -->
    <select id="findInquiryReplyById" resultType="com.road_friends.rentalcar.dto.AdminInquiryDto">
        SELECT inquiries_num, user_num, admin_num, inquiries_q, inquiries_a, inquiries_q_created_at, inquiries_a_created_at
        FROM inquiries
        WHERE inquiries_num = #{inquiryId};
    </select>

    <!-- 관리자 질문 답변 등록 -->
    <update id="updateInquiryReply" >
        UPDATE inquiries
        SET admin_num = #{adminNum},
        inquiries_a = #{inquiriesA},
        inquiries_a_created_at = CONVERT_TZ(NOW(), @@global.time_zone, 'Asia/Seoul')
        WHERE inquiries_num = #{inquiryId};
    </update>

    <!-- 관리자 질문 답변만 삭제 -->
    <update id="clearInquiryAnswer" parameterType="com.road_friends.rentalcar.dto.AdminInquiryDto">
        UPDATE inquiries
        SET admin_num = NULL, inquiries_a = NULL, inquiries_a_created_at = NULL
        WHERE inquiries_num = #{inquiryId};
    </update>

    <!-- 관리자 질문 게시글 삭제 -->
    <delete id="deleteInquiry">
        DELETE FROM inquiries WHERE inquiries_num = #{inquiryId};
    </delete>

    <!-- 총 게시글 개수 -->
    <select id="countTotalInquiries" resultType="long">
        SELECT COUNT(*) FROM inquiries;
    </select>

    <!-- 답변 완료 게시글 개수 (inquiriesA가 NULL이 아닌 경우) -->
    <select id="countAnsweredInquiries" resultType="long">
        SELECT COUNT(*) FROM inquiries WHERE inquiries_a IS NOT NULL;
    </select>

    <!-- 미답변 게시글 개수 (inquiriesA가 NULL인 경우) -->
    <select id="countUnansweredInquiries" resultType="long">
        SELECT COUNT(*) FROM inquiries WHERE inquiries_a IS NULL;
    </select>

</mapper>