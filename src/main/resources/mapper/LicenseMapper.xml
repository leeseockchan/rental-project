<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.road_friends.rentalcar.mapper.LicenseMapper">

    <!-- 면허증 정보 삽입 -->
    <insert id="insertLicense" parameterType="com.road_friends.rentalcar.dto.LicenseDto">
        INSERT INTO license (license_num, license_date, license_end_date, user_num, license_photo_path)
        VALUES (#{licenseNum}, #{licenseDate}, #{licenseEndDate}, #{userNum}, #{licensePhotoPath})
    </insert>

    <!-- 사용자 번호를 기반으로 면허증 정보 조회 -->
    <select id="findLicenseByUserNum" resultType="com.road_friends.rentalcar.dto.LicenseDto">
        SELECT
        license_id AS licenseId,
        license_num AS licenseNum,
        license_date AS licenseDate,
        license_end_date AS licenseEndDate,
        license_photo_path AS licensePhotoPath,
        user_num AS userNum
        FROM license
        WHERE user_num = #{userNum}
        LIMIT 1
    </select>

    <!-- 사용자 권한을 ROLE_VERIFIED (3)로 변경 -->
    <update id="updateUserRoleToVerified">
        UPDATE user_roles
        SET role_id = 3
        WHERE user_id = #{userNum}
    </update>

</mapper>