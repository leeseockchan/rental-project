<!DOCTYPE html>
<html lang="utf-8" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf"
  layout:decorate="~{layout/layout}">

<head>
  <title>ì£¼ì°¨ì¥ ê´€ë¦¬ ëª©ë¡</title>

  <link rel="stylesheet" th:href="@{/css/parking/parking-list.css}">

  <!--    ì•„íŒŒì¹˜ Eì°¨íŠ¸-->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>

  <script th:inline="javascript">
    // ì£¼ì°¨ì¥ë³„ ì°¨ëŸ‰ ë³´ìœ ëŸ‰ ìˆœìœ„ ë°ì´í„°
    var top5ParkingStats = /*[[${top5ParkingStats}]]*/ '[]'; // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    // JSON ë³€í™˜
    var top5ParkingStatsParsed = [[${top5ParkingStats}]];

    // ì§€ì—­ë³„ ì£¼ì°¨ì¥ ê°œìˆ˜ ë°ì´í„°
    var parkingCountByRegion = /*[[${parkingCountByRegion}]]*/ '[]'; // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    // JSON ë³€í™˜
    var parkingCountByRegionParsed = [[${parkingCountByRegion}]];
  </script>

  </script>

  <th:block layout:fragment="js">
    <script th:src="@{/js/parking/chart.js}"></script>
    <script th:inline="javascript">
      document.getElementById("provinceSelect").addEventListener("change", function() {
          var province = this.value;
          var districtSelect = document.getElementById("districtSelect");

          districtSelect.innerHTML = '<option value="">êµ¬/êµ°ì„ ì„ íƒí•˜ì„¸ìš”</option>';

          if (province) {
              fetch(`/api/admin/parkings/districts?province=` + encodeURIComponent(province))
                  .then(response => response.json())
                  .then(data => {
                      data.forEach(district => {
                          var option = document.createElement("option");
                          option.value = district;
                          option.textContent = district;
                          districtSelect.appendChild(option);
                      });
                  })
                  .catch(error => console.error('Error:', error));
          }
      });

      document.getElementById("searchBtn").addEventListener("click", function() {
        var district = document.getElementById("districtSelect").value;

        fetch(`/api/admin/parkings/search?district=` + encodeURIComponent(district))
            .then(response => response.json())
            .then(data => {
                var tableBody = document.querySelector("tbody");
                tableBody.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

                data.forEach(parking => {
                    var row = document.createElement("tr");
                    row.setAttribute("data-href", `/api/admin/parkings/${parking.parkingId}`); // ğŸš€ data-href ì¶”ê°€

                    row.innerHTML = `
                        <td>${parking.parkingName}</td>
                        <td>${parking.parkingAddress}</td>
                        <td>${parking.parkingProvince}</td>
                        <td>${parking.parkingDistrict}</td>
                        <td>${parking.parkingLatitude}</td>
                        <td>${parking.parkingLongtitude}</td>
                        <td>${parking.carCount}</td>
                    `;

                    tableBody.appendChild(row);
                });

                // ğŸš€ ìƒˆë¡œ ì¶”ê°€ëœ <tr>ì—ë„ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€!
                attachRowClickEvent();
            })
            .catch(error => console.error('Error:', error));
    });

    // âœ… <tr>ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë‹¤ì‹œ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
    function attachRowClickEvent() {
        document.querySelectorAll(".table-box tbody tr").forEach(row => {
            row.addEventListener("click", function() {
                const url = this.getAttribute("data-href"); // data-href ê°’ ê°€ì ¸ì˜¤ê¸°
                if (url) {
                    window.location.href = url;
                } else {
                    console.error("data-hrefê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ:", this);
                }
            });
        });
    }

    // âœ… í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ ê¸°ì¡´ <tr>ì—ë„ ì´ë²¤íŠ¸ ì¶”ê°€
    document.addEventListener("DOMContentLoaded", attachRowClickEvent);

    </script>
  </th:block>


</head>

<body>
  <div class="content" layout:fragment="content">

    <div class="header">
      ì£¼ì°¨ì¥ ê´€ë¦¬
    </div>

    <div class="info">
      <div class="info-header">ì£¼ì°¨ì¥ í†µê³„</div>

      <div class="info-group">
        <div class="info-box-big-group">
          <div class="info-box-big only-text-box-big">
            <div class="info-box-big-header">ì „ì²´ ì£¼ì°¨ì¥ í†µê³„</div>
            <div class="info-box-sm">
              <div class="info-box box1">
                <div class="info-box-title">ì „ì²´ ì£¼ì°¨ì¥</div>
                <div class="info-box-content">
                  <span th:text="${parkingStats['total']}"></span> ê°œ
                </div>
              </div>
              <div class="info-box box2">
                <div class="info-box-title">ì„œìš¸ ê²½ê¸° ì¸ì²œ</div>
                <div class="info-box-content">
                  <span th:text="${parkingStats['capital']}"></span> ê°œ
                </div>
              </div>
              <div class="info-box box3">
                <div class="info-box-title">ë¹„ìˆ˜ë„ê¶Œ ì§€ë°©</div>
                <div class="info-box-content">
                  <span th:text="${parkingStats['nonCapital']}"></span> ê°œ
                </div>
              </div>
            </div>
          </div>
          <div class="info-box-big semi-circle-box-big">
            <div class="info-box-big-header" style="margin-bottom : 0">ì£¼ì°¨ì¥ë³„ ì°¨ëŸ‰ ë³´ìœ ëŸ‰ ìˆœìœ„</div>
            <div class="chart-box semi-circle-box">
              <div class="chart-content chart1" id="chart-container1"></div>
            </div>
          </div>
        </div>

        <div class="info-box-big-group">
          <div class="info-box-big">
            <div class="info-box-big-header">ì§€ì—­ë³„ ì£¼ì°¨ì¥ ê°œìˆ˜</div>
            <div class="chart-box">
              <div class="chart-content chart2" id="chart-container2">
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="list">
      <div class="info-header">ë“±ë¡ëœ ì£¼ì°¨ì¥ ìƒì„¸ ê²€ìƒ‰</div>

      <div class="filter-box-big">
        <div class="filter-box">
          <!-- ì§€ì—­ ì„ íƒ -->
          <label for="provinceSelect">ì‹œ/ë„</label>
          <select id="provinceSelect">
            <option value="">ì‹œ/ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            <option th:each="province : ${provinceList}" th:value="${province}" th:text="${province}"></option>
          </select>

          <label for="districtSelect">ì‹œ/êµ°/êµ¬</label>
          <select id="districtSelect">
            <option value="">êµ¬/êµ°ì„ ì„ íƒí•˜ì„¸ìš”</option>
          </select>

          <div class="btn-group">
            <button type="button" class="btn-search" id="searchBtn">ê²€ìƒ‰</button>
          </div>
        </div>

        <div class="btn-group">
          <button type="button" class="btn-update" th:onclick="|location.href='@{/api/admin/parkings/add}'|">
            ì‹ ê·œ ì£¼ì°¨ì¥ ë“±ë¡
          </button>
        </div>
      </div>

      <table class="table-box">
        <thead>
          <tr>
            <th style="width: 100px;">ì£¼ì°¨ì¥ ì´ë¦„</th>
            <th style="width: 150px;">ì£¼ì†Œ</th>
            <th style="width: 100px;">ì§€ì—­</th>
            <th style="width: 100px;">ë„ì‹œ</th>
            <th style="width: 100px;">ìœ„ë„</th>
            <th style="width: 100px;">ê²½ë„</th>
            <th style="width: 100px;">ë³´ìœ ì°¨ëŸ‰ ëŒ€ìˆ˜</th>
          </tr>
        </thead>
        <tbody>
        <tr th:each="parking : ${parkingList}"
            th:data-href="@{/api/admin/parkings/{parkingId}(parkingId=${parking.parkingId})}">
            <td th:text="${parking.parkingName}"></td>
            <td th:text="${parking.parkingAddress}"></td>
            <td th:text="${parking.parkingProvince}"></td>
            <td th:text="${parking.parkingDistrict}"></td>
            <td th:text="${parking.parkingLatitude}"></td>
            <td th:text="${parking.parkingLongtitude}"></td>
            <td th:text="${parking.carCount}">0</td>
          </tr>
        </tbody>

      </table>

<!--      &lt;!&ndash; í˜ì´ì§€ë„¤ì´ì…˜ &ndash;&gt;-->
<!--      <div class="pagination">-->
<!--        <a href="" if="">-->
<!--          <span class="material-symbols-outlined">-->
<!--            chevron_left-->
<!--          </span>-->
<!--        </a>-->
<!--        <span class="page-number" each="">-->
<!--          <a href="" text="" classappend=""></a>-->
<!--        </span>-->
<!--        <a href="" if="">-->
<!--          <span class="material-symbols-outlined">-->
<!--            chevron_right-->
<!--          </span>-->
<!--        </a>-->
<!--      </div>-->

    </div>
  </div>

</body>

</html>