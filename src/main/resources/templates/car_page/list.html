<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì°¨ëŸ‰ ìƒíƒœ ê´€ë¦¬ ëª©ë¡í˜ì´ì§€</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h1>ì°¨ëŸ‰ ìƒì„¸ ê²€ìƒ‰</h1>
<!-- ì§€ì—­ ì„ íƒ -->
<label for="provinceSelect">ì‹œ/ë„ ì„ íƒ:</label>
<select id="provinceSelect">
    <option value="">ì‹œ/ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
    <option th:each="province : ${provinceList}" th:value="${province}" th:text="${province}"></option>
</select>

<label for="districtSelect">êµ¬/êµ° ì„ íƒ:</label>
<select id="districtSelect">
    <option value="">êµ¬/êµ°ì„ ì„ íƒí•˜ì„¸ìš”</option>
</select>

<button type="button" id="searchBtn">ê²€ìƒ‰</button>

<table>
    <thead>
    <tr>
        <td>ë„/ì‹œ</td>
        <td>ì§€ì—­</td>
        <td>
            <a id="add_car" th:href="@{/api/admin/vehicles/add}">
                <button type="button">ì‹ ê·œ ì°¨ëŸ‰ ë“±ë¡</button>
            </a>
        </td>
    </tr>
    <tr>
        <th>ì°¨ëŸ‰ë²ˆí˜¸</th>
        <th>ì œì¡°ì‚¬</th>
        <th>ëª¨ë¸ëª…</th>
        <th>ë“±ê¸‰</th>
        <th>ì¹´í…Œê³ ë¦¬</th>
        <th>ì°¨ëŸ‰ í˜„í™©</th>
        <th>í˜„ìœ„ì¹˜ ì£¼ì°¨ì¥</th>
    </tr>
    </thead>
    <tbody id="carList">
    <tr th:each="car : ${cars}" th:onclick="|location.href='@{/api/admin/vehicles/{carId}(carId=${car.carId})}'|" style="cursor: pointer;">
        <td th:text="${car.carId}"> </td>
        <td th:text="${car.model.modelBrand}"></td>
        <td th:text="${car.model.modelName}"></td>
        <td th:text="${car.carGrade}"></td>
        <td th:text="${car.carCategory}"></td>
        <td th:text="${car.carStatus}"></td>
        <td th:text="${car.parking.parkingName}"></td>
    </tr>
    </tbody>
</table>

<script>
    $(document).ready(function() {
        // ì‹œ/ë„ ì„ íƒ ì‹œ, í•´ë‹¹ êµ¬/êµ° ê°€ì ¸ì˜¤ê¸°
        $("#provinceSelect").change(function() {
            let province = $(this).val();
            $("#districtSelect").empty().append('<option value="">êµ¬/êµ°ì„ ì„ íƒí•˜ì„¸ìš”</option>');

            if (province) {
                $.get("/api/admin/vehicles/districts", { province: province }, function(data) {
                    $.each(data, function(index, district) {
                        $("#districtSelect").append('<option value="' + district + '">' + district + '</option>');
                    });
                });
            }
        });

        // ì°¨ëŸ‰ ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ
        $("#searchBtn").click(function() {
            let district = $("#districtSelect").val();

            if (!district) {
                alert("êµ¬/êµ°ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                return;
            }

$.get("/api/admin/vehicles/search", { district: district }, function(cars) {
    console.log("ê²€ìƒ‰ëœ ì°¨ëŸ‰ ë°ì´í„°:", cars);  // ğŸ‘‰ ì‹¤ì œ ì‘ë‹µ í™•ì¸

    let carListHtml = "";
    $.each(cars, function(index, car) {
        console.log("ê°œë³„ ì°¨ëŸ‰ ë°ì´í„°:", car);  // ğŸ‘‰ ê°œë³„ ì°¨ëŸ‰ ë°ì´í„° í™•ì¸

        carListHtml += `
            <tr onclick="location.href='/api/admin/vehicles/${car.carId}'" style="cursor: pointer;">
                <td>${car.carId}</td>
                <td>${car.model.modelBrand}</td>
                <td>${car.model.modelName}</td>
                <td>${car.carGrade}</td>
                <td>${car.carCategory}</td>
                <td>${car.carStatus}</td>
                <td>${car.parking.parkingName}</td>
            </tr>`;
    });
    $("#carList").html(carListHtml);
});
        });
    });
</script>

</body>
</html>
