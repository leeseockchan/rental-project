<!DOCTYPE html>
<html lang="utf-8" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf"
    layout:decorate="~{layout/layout}">

<head>
    <title>ì°¨ëŸ‰ ê´€ë¦¬ ëª©ë¡</title>

    <link rel="stylesheet" th:href="@{/css/car/car-list.css}">

    <!--    ì•„íŒŒì¹˜ Eì°¨íŠ¸-->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script th:src="@{/js/car/chart.js}" defer></script>

    <script th:inline="javascript">
        var carGradeData = /*[[${carGrades}]]*/ '[]';
        var carRankingData = /*[[${carRanking}]]*/ '[]';
        var carBrandData = /*[[${carBrands}]]*/ '[]';

        // JSON ë³€í™˜
        var carGradeParsed = [[${carGrades}]];
        var carRankingParsed = [[${carRanking}]];
        var carBrandParsed = [[${carBrands}]];
    </script>

    <script defer>
        $(document).ready(function () {
            // ì‹œ/ë„ ì„ íƒ ì‹œ, í•´ë‹¹ êµ¬/êµ° ê°€ì ¸ì˜¤ê¸°
            $("#provinceSelect").change(function () {
                let province = $(this).val();
                $("#districtSelect").empty().append('<option value="">êµ¬/êµ°ì„ ì„ íƒí•˜ì„¸ìš”</option>');

                if (province) {
                    $.get("/admin/vehicles/districts", { province: province }, function (data) {
                        $.each(data, function (index, district) {
                            $("#districtSelect").append('<option value="' + district + '">' + district + '</option>');
                        });
                    });
                }
            });

            // ì°¨ëŸ‰ ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ
            $("#searchBtn").click(function () {
                let district = $("#districtSelect").val();

                if (!district) {
                    alert("êµ¬/êµ°ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                    return;
                }

                $.get("/admin/vehicles/search", { district: district }, function (cars) {
                    console.log("ê²€ìƒ‰ëœ ì°¨ëŸ‰ ë°ì´í„°:", cars);  // ğŸ‘‰ ì‹¤ì œ ì‘ë‹µ í™•ì¸

                    let carListHtml = "";
                    $.each(cars, function (index, car) {
                        console.log("ê°œë³„ ì°¨ëŸ‰ ë°ì´í„°:", car);  // ğŸ‘‰ ê°œë³„ ì°¨ëŸ‰ ë°ì´í„° í™•ì¸

                        carListHtml += `
                        <tr onclick="location.href='/admin/vehicles/${car.carId}'" style="cursor: pointer;">
                            <td>${car.carId}</td>
                            <td>${car.model.modelBrand}</td>
                            <td>${car.model.modelName}</td>
                            <td>${car.carGrade}</td>
                            <td>${car.carCategory}</td>
                            <td>${car.carStatus}</td>
                            <td>${car.parking.parkingName}</td>
                        </tr>`;
                    });
                    $("#carList").html(carListHtml);
                });
            });
        });
    </script>

</head>

<body>
    <div class="content" layout:fragment="content">

        <div class="header">
            ì°¨ëŸ‰ ê´€ë¦¬
        </div>

        <div class="info">
            <div class="info-header">ë³´ìœ  ì°¨ëŸ‰ í†µê³„</div>

            <div class="info-box-big-group">
                <div class="info-box-big only-text-box-big">
                    <div class="info-box-big-header">ì „ì²´ ì°¨ëŸ‰ ëŒ€ìˆ˜</div>
                    <div class="info-box-sm">
                        <div class="info-box box1">
                            <div class="info-box-title">ì „ì²´ ë³´ìœ  ì°¨ëŸ‰</div>
                            <div class="info-box-content"><span th:text="${totalVehicles}"></span> ëŒ€</div>
                        </div>
                        <div class="info-box box2">
                            <div class="info-box-title">í˜„ì¬ ëŒ€ì—¬ì¤‘ì¸ ì°¨ëŸ‰</div>
                            <div class="info-box-content"><span th:text="${rentedVehicles}"></span> ëŒ€</div>
                        </div>
                        <div class="info-box box3">
                            <div class="info-box-title">ìˆ˜ë¦¬ì¤‘ì¸ ì°¨ëŸ‰</div>
                            <div class="info-box-content"><span th:text="${repairVehicles}"></span> ëŒ€</div>
                        </div>
                    </div>
                </div>
                <div class="info-box-big semi-circle-box-big">
                    <div class="info-box-big-header" style="margin-bottom : 0">ì°¨ëŸ‰ ë“±ê¸‰ë³„ ë³´ìœ  í˜„í™©</div>
                    <div class="chart-box semi-circle-box">
                        <div class="chart-content chart1" id="chart-container1"></div>
                    </div>
                </div>
            </div>

            <div class="info-box-big-group">
                <div class="info-box-big">
                    <div class="info-box-big-header">ë³´ìœ  ì°¨ëŸ‰ ìˆœìœ„</div>
                    <div class="chart-box">
                        <div class="chart-content chart2" id="chart-container2">
                        </div>
                    </div>
                </div>
                <div class="info-box-big">
                    <div class="info-box-big-header">ì œì¡°ì‚¬ ë³„ ì°¨ëŸ‰ ëŒ€ìˆ˜</div>
                    <div class="chart-box">
                        <div class="chart-content chart3" id="chart-container3"></div>
                    </div>
                </div>
            </div>

        </div>

        <div class="list">
            <div class="info-header">ì°¨ëŸ‰ ìƒì„¸ ê²€ìƒ‰</div>

            <div class="filter-box-big">
                <div class="filter-box">
                    <label for="provinceSelect">ì‹œ/ë„ ì„ íƒ</label>
                    <select id="provinceSelect">
                        <option value="">ì‹œ/ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        <option th:each="province : ${provinceList}" th:value="${province}" th:text="${province}">
                        </option>
                    </select>

                    <label for="districtSelect">êµ¬/êµ° ì„ íƒ</label>
                    <select id="districtSelect">
                        <option value="">êµ¬/êµ°ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>

                    <div class="btn-group">
                        <button type="button" id="searchBtn" class="btn-search">ê²€ìƒ‰</button>
                    </div>

                </div>

                <div class="btn-group">
                    <button type="button" id="add_car" class="btn-update"
                        th:onclick="'location.href=\'' + @{/admin/vehicles/add} + '\''">
                        ì£¼ì°¨ì¥ì— ìƒˆ ì°¨ëŸ‰ì„ ë“±ë¡
                    </button>
                </div>
            </div>

            <table class="table-box">
                <thead>
                    <tr>
                        <th style="width: 50px;">ì°¨ëŸ‰ ë²ˆí˜¸</th>
                        <th style="width: 80px;">ì œì¡°ì‚¬</th>
                        <th style="width: 80px;">ëª¨ë¸ëª…</th>
                        <th style="width: 80px;">ë“±ê¸‰</th>
                        <th style="width: 80px;">ì¹´í…Œê³ ë¦¬</th>
                        <th style="width: 100px;">ëŒ€ì—¬ ìƒíƒœ</th>
                        <th style="width: 180px;">í˜„ì¬ ìœ„ì¹˜í•œ ì£¼ì°¨ì¥</th>
                    </tr>
                </thead>
                <tbody id="carList">
                    <tr th:each="car : ${cars}" th:attr="data-href=@{/admin/vehicles/{carId}(carId=${car.carId})}"
                        onclick="location.href=this.getAttribute('data-href')">
                        <td th:text="${car.carId}" style="max-width: 50px;"></td>
                        <td th:text="${car.model.modelBrand}" style="max-width: 80px;"></td>
                        <td th:text="${car.model.modelName}" style="max-width: 80px;"></td>
                        <td th:text="${car.carGrade}" style="max-width: 80px;"></td>
                        <td th:text="${car.carCategory}" style="max-width: 80px;"></td>
                        <td th:text="${car.carStatus}" style="max-width: 100px;"></td>
                        <td th:text="${car.parking.parkingName}" style="max-width: 180px;"></td>
                    </tr>
                </tbody>
            </table>

            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <!--            <div class="pagination">-->
            <!--                <a th:href="@{/api/admin/vehicles(page=${pageDto.start - 1}, size=${pageDto.size})}"-->
            <!--                    th:if="${pageDto.prev}">-->
            <!--                    <span class="material-symbols-outlined">-->
            <!--                        chevron_left-->
            <!--                    </span>-->
            <!--                </a>-->
            <!--                <span class="page-number" th:each="pageNum : ${#numbers.sequence(pageDto.start, pageDto.end)}">-->
            <!--                    <a th:href="@{/api/admin/vehicles(page=${pageNum}, size=${pageDto.size})}" th:text="${pageNum}"-->
            <!--                        th:classappend="${pageNum == pageDto.page} ? 'active' : ''"></a>-->
            <!--                </span>-->
            <!--                <a th:href="@{/api/admin/vehicles(page=${pageDto.end + 1}, size=${pageDto.size})}"-->
            <!--                    th:if="${pageDto.next}">-->
            <!--                    <span class="material-symbols-outlined">-->
            <!--                        chevron_right-->
            <!--                    </span>-->
            <!--                </a>-->
            <!--            </div>-->

        </div>
    </div>

</body>

</html>