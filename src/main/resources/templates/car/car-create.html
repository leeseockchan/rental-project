<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf"
    layout:decorate="~{layout/layout}">

<head>
    <title>ì°¨ëŸ‰ ê´€ë¦¬ ë“±ë¡</title>

    <link rel="stylesheet" th:href="@{/css/car/car-update.css}">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script th:src="@{/js/car/carAdd.js}" defer></script>

    <script>
        $(document).ready(function () {
            // âœ… 1. ì‹œ/ë„(Province) ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            $.get("/admin/vehicles/provinces", function (data) {
                console.log("ğŸ“Œ ì‹œ/ë„ ëª©ë¡:", data); // ğŸ›  ë””ë²„ê¹…ìš© ì½˜ì†” ì¶œë ¥
                $("#parkingProvince").empty().append('<option value="">-- ë„/ì‹œ ì„ íƒ --</option>');
                $.each(data, function (index, province) {
                    $("#parkingProvince").append('<option value="' + province + '">' + province + '</option>');
                });
            });

            // âœ… 2. ì‹œ/ë„ ì„ íƒ ì‹œ í–‰ì •êµ¬ì—­(êµ¬/êµ°) ëª©ë¡ ê°±ì‹ 
            $("#parkingProvince").change(function () {
                let selectedProvince = $(this).val();
                $("#parkingDistrict").empty().append('<option value="">-- í–‰ì •êµ¬ì—­ ì„ íƒ --</option>');
                $("#carParking").empty().append('<option value="">-- ì£¼ì°¨ì¥ ì„ íƒ --</option>');
                $("#parkingLatitude").val('');
                $("#parkingLongitude").val('');

                if (selectedProvince) {
                    $.get("/admin/vehicles/districts", { province: selectedProvince }, function (data) {
                        console.log("ğŸ“Œ í–‰ì •êµ¬ì—­ ëª©ë¡:", data); // ğŸ›  ë””ë²„ê¹…ìš© ì½˜ì†” ì¶œë ¥
                        $.each(data, function (index, district) {
                            $("#parkingDistrict").append('<option value="' + district + '">' + district + '</option>');
                        });
                    });
                }
            });

            // âœ… 3. í–‰ì •êµ¬ì—­ ì„ íƒ ì‹œ ì£¼ì°¨ì¥ ëª©ë¡ ê°±ì‹ 
            $("#parkingDistrict").change(function () {
                let selectedProvince = $("#parkingProvince").val();
                let selectedDistrict = $(this).val();
                $("#carParking").empty().append('<option value="">-- ì£¼ì°¨ì¥ ì„ íƒ --</option>');
                $("#parkingLatitude").val('');
                $("#parkingLongitude").val('');

                if (selectedDistrict) {
                    $.get("/admin/vehicles/parkings", { province: selectedProvince, district: selectedDistrict }, function (data) {
                        console.log("ğŸ“Œ ì£¼ì°¨ì¥ ëª©ë¡:", data); // ğŸ›  ë””ë²„ê¹…ìš© ì½˜ì†” ì¶œë ¥
                        $.each(data, function (index, parking) {
                            $("#carParking").append('<option value="' + parking.parkingId + '" data-lat="' + parking.parkingLatitude + '" data-lng="' + parking.parkingLongtitude + '">' + parking.parkingName + '</option>');
                        });
                    });
                }
            });

            // âœ… 4. ì£¼ì°¨ì¥ ì„ íƒ ì‹œ ìœ„ë„, ê²½ë„ ìë™ ì…ë ¥
            $("#carParking").change(function () {
                let selectedOption = $(this).find("option:selected");
                let lat = selectedOption.attr("data-lat");
                let lng = selectedOption.attr("data-lng");

                $("#parkingLatitude").val(lat ? lat : '');
                $("#parkingLongitude").val(lng ? lng : '');
            });
        });
    </script>

</head>

<body>
    <div class="content" layout:fragment="content">

        <div class="header">
            ì°¨ëŸ‰ ê´€ë¦¬
        </div>

        <div class="info">
            <div class="header-sm">
                ì°¨ëŸ‰ ê´€ë¦¬ > ì‹ ê·œ ì°¨ëŸ‰ ë“±ë¡
            </div>
            <form id="add_carData" th:action="@{/admin/vehicles/add}" method="post">
                <div class="info-box-big">

                    <div class="info-box box1">
                        <div class="info-box-title">ì°¨ëŸ‰ ì •ë³´ ë“±ë¡</div>
                        <div class="info-box-content">
                            <div class="info-box-content-row">
                                <label for="carBrand">ì œì¡°ì‚¬</label>
                                <select id="carBrand" name="model.modelBrand">
                                    <option value="" selected>-- ì œì¡°ì‚¬ ì„ íƒ --</option>
                                    <option th:each="brand: ${mBrandList}" th:value="${brand}" th:text="${brand}">
                                    </option>
                                </select>
                            </div>
                            <div class="info-box-content-row">
                                <label for="carModelName">ì°¨ëŸ‰ ëª¨ë¸</label>
                                <select id="carModelName" name="model.modelName">
                                    <option value="">-- ëª¨ë¸ ì„ íƒ --</option>
                                    <!-- ì°¨ëŸ‰ ëª¨ë¸ ì˜µì…˜ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                                </select>
                            </div>
                            <div class="info-box-content-row">
                                <label for="carYear">ì—°ì‹</label>
                                <select id="carYear" name="carYear">
                                    <option th:each="yearList: ${yearList}" th:value="${yearList}"
                                        th:text="${yearList}"></option>
                                </select>
                            </div>
                            <div class="info-box-content-row">
                                <label for="carFuel">ì—°ë£Œ</label>
                                <select id="carFuel" name="carFuel">
                                    <option th:each="fuel : ${fuelList}" th:value="${fuel}" th:text="${fuel}"></option>
                                </select>
                            </div>
                            <div class="info-box-content-row">
                                <label for="carGrade">ë“±ê¸‰</label>
                                <select id="carGrade" name="carGrade">
                                    <option th:each="grade : ${gradeList}" th:value="${grade}" th:text="${grade}">
                                    </option>
                                </select>
                            </div>
                            <div class="info-box-content-row">
                                <label for="carCategory">ì„œë¹„ìŠ¤ ì¹´í…Œê³ ë¦¬</label>
                                <select id="carCategory" name="carCategory" required>
                                    <option value="0">ë¹ ë¥¸ëŒ€ì—¬</option>
                                    <option value="1">ë‹¨ê¸°ëŒ€ì—¬</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="info-box box2">
                        <div class="info-box-title">ë³´ìœ  ì£¼ì°¨ì¥</div>
                        <div class="info-box-content two">
                            <div class="info-box-content-row">
                                <label for="parkingProvince">ë„/ì‹œ</label>
                                <select id="parkingProvince" name="parking.province">
                                    <option value="">-- ë„/ì‹œ ì„ íƒ --</option>
                                    <option th:each="province : ${provinceList}" th:value="${province}"
                                        th:text="${province}"></option>
                                </select>
                            </div>
                            <div class="info-box-content-row">
                                <label for="parkingDistrict">í–‰ì •êµ¬ì—­</label>
                                <select id="parkingDistrict" name="parking.district">
                                    <option value="">-- í–‰ì •êµ¬ì—­ ì„ íƒ --</option>
                                </select>
                            </div>
                            <div class="info-box-content-row">
                                <label for="carParking">ì£¼ì°¨ì¥ ì´ë¦„</label>
                                <select id="carParking" name="parking.parkingId">
                                    <option value="">-- ì£¼ì°¨ì¥ ì„ íƒ --</option>
                                </select>
                            </div>
                        </div>
                        <div class="info-box-content">
                            <div class="info-box-content-row">
                                <label for="parkingLatitude">ìœ„ë„</label>
                                <input type="text" id="parkingLatitude" name="parkingLatitude" readonly />
                            </div>
                            <div class="info-box-content-row">
                                <label for="parkingLongitude">ê²½ë„</label>
                                <input type="text" id="parkingLongitude" name="parkingLongitude" readonly />
                            </div>
                        </div>
                    </div>

                </div>

                <div class="btn-group">
                    <button type="button" class="btn-go-back"
                        th:onclick="'location.href=\'' + @{/admin/vehicles} + '\''">
                        ëª©ë¡ìœ¼ë¡œ
                    </button>
                    <button type="submit" class="btn-update" id="submit">
                        ë“±ë¡í•˜ê¸°
                    </button>
                </div>
            </form>
        </div>

    </div>
</body>

</html>